<!-- MADE BY THOMAS HEBRARD
    AND    EDOUARD LAJOUANIE
-->
<html>
    <head>
        <meta charset="utf-8">
        <title>Domino</title>
        <link rel="stylesheet" type="text/css" href="indexcss.css">
    </head>
    <body>
        <div id="sign">
            Username: <input id="sign-username" type="text"></input><br>
            Password: <input id="sign-password" type="password"></input>
            <button id="sign-signIn">Sign In</button>
            <button id="sign-signUp">Sign Up</button>
        </div>
        
        <div id="game" style="display:none;">
            <div>
                <canvas id = "deck" width="500" height="200"
                style="border:1px solid blue"></canvas>
                <canvas id = "ctxx" width="500" height="200" 
                style="border:1px solid red;"></canvas>
            </div>
            <canvas id = "ctx" width="1000" height="500" 
                style="border:1px solid #000000;"></canvas>
        
        <div id="chat-text" style="width:100px;height:100px;overflow-y:scroll">
            <div>Hello!</div>
        </div>
    
        <form id="chat-form">
            <input id="chat-input" type="text" style="width:500px"></input>
        </form>
        </div>
    </body>
</html>

<script src="/socket.io/socket.io.js"></script>

<script>
    /* On initialise la connection entre le client et le serveur */
    var socket = io();

    /******************** Sign ********************/

    var sign = document.getElementById('sign');
    var sign_username = document.getElementById('sign-username');
    var sign_password = document.getElementById('sign-password');
    var sign_signIn = document.getElementById('sign-signIn');
    var sign_signUp = document.getElementById('sign-signUp');

    sign_signIn.onclick = function(){
        socket.emit('signIn', {username:sign_username.value, password:sign_password.value});
    }

    sign_signUp.onclick = function(){
        socket.emit('signUp', {username:sign_username.value, password:sign_password.value})
    }

    socket.on('signInResponse', function(data){
        if(data.success){
            sign.style.display = 'none';
            game.style.display = 'inline-block';
        } else {
            alert('Mot de passe ou username incorrect');
        }
    });

    socket.on('signUpResponse', function(data){
        if (data.success){
            alert('Enregistrement correct');
        } else {
            alert('Enregistrement incorrect');
        }
    });

    /******************** Le chat instantané *******************/

    var chatText = document.getElementById('chat-text');
    var chatInput = document.getElementById('chat-input');
    var chatForm = document.getElementById('chat-form');

    socket.on('addToChat', function(data){
        chatText.innerHTML += '<div>' + data + '</div>';
    });

    chatForm.onsubmit = function(e){
        /* Si on a pas un preventDefault, en appuyant sur entrée, cela va
        refresh la page. */
        e.preventDefault();
        /* On envoit au server le message que l'on veut envoyer sous vorme d'une variable */
        socket.emit('sendMsgToServer', chatInput.value);
        /* On resert la variable */
        chatInput.value = '';
    };

    /**************************** Le Jeu ************************/

    /* Pour dessiner le terrain de jeu*/
    var c1 = document.getElementById("ctx");
    var pinceau = c1.getContext("2d");
    c1.font = '30px Arial';

    /* Tracé de la grille */
    var ecart = 45; 

    /* Lignes */
    for(var h = ecart ; h < c1.height ; h += ecart) {
        pinceau.moveTo(0, h); //déplacer le pinceau à (x,y) sans tracer
        pinceau.lineTo(c1.width, h); //tracer jusqu'à (x,y)
    }
    /* Colonnes */
    for(var w = ecart ; w < c1.width ; w += ecart) {
        pinceau.moveTo(w, 0);
        pinceau.lineTo(w, c1.height);
    }
    /* Tracé */
    pinceau.stroke();

    /* Pour dessiner le deck de chaque joueur */
    var deck = document.getElementById("deck").getContext("2d");
    deck.font = '30px Arial';

    /********* Dessin des dominos ************/

    var drawDomino = function(data){
        deck.strokeRect(data.x, data.y, 45, 45, "blue");
        deck.fillText(data.numbre.toString(), data.x+15, data.y+30);
    }

    socket.on('drawDeck', function(data){
        /* Définition des bords */
        var a = 10;
        var b = 10;
        /* data est ici la variable deck, un array des 7 Dominos du Deck */
        for (var i = 0; i < 7; i++){
            drawDomino({numbre: data[i].numbre_1, x: a+(i*65), y: b});
            drawDomino({numbre: data[i].numbre_2, x: a+(i*65), y: b+45});
        }
    });
</script>
